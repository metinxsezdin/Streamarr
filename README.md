<div align="center">

# Streamarr

**Turkish Streaming Resolver Suite for Jellyfin**

</div>

Streamarr harvests stream URLs from popular Turkish streaming sites, exposes them through a resolver API, and integrates with Jellyfin via STRM libraries and a native plugin.

---

## Highlights

- **Modular Architecture** – Playwright scrapers, resolver API, metadata enrichment, and plugin separated cleanly
- **Dizibox & HDFilm Support** – Automation for the two most-requested Turkish streaming sources
- **On-Demand Resolution** – Stream URLs are refreshed only when a user presses play
- **Jellyfin Plugin** – Adds a configuration UI and /play/<id> integration
- **CLI Utilities** – Collect links, build catalogs, generate STRM files, update plugin manifest
- **Docker Support** – Run the resolver API in a container with a single command

---

## Repository Layout

| Path | Purpose |
|------|---------|
| ackend/resolver/ | Playwright scrapers & Flask resolver API |
| scripts/ | CLI utilities (collect_links, catalog_builder, strm_generator, update_manifest) |
| plugins/Streamarr/ | Jellyfin plugin source (config page, metadata providers, build output) |
| data/ | Harvested link lists and generated catalog |
| output/strm/ | Autogenerated STRM files ready to import into Jellyfin |
| docs/archive/ | Legacy POC notes and exploratory scripts |

---

## Requirements

- **Python** 3.11+
- **Playwright** (pip install -r requirements.txt and playwright install firefox)
- **.NET SDK** 8.0 (for Jellyfin plugin builds)
- **Optional** TMDB API key (TMDB_KEY) for metadata enrichment

---

## Docker Deployment

The resolver API ships with a ready-to-use Docker configuration.

`ash
# Build and start the resolver API
docker compose up -d

# The API is now available at http://127.0.0.1:5055
`

By default the container mounts ./data inside /app/data, so any catalog updates on the host are immediately visible. Environment variables you can override:

- TMDB_KEY – optional TMDB API key for catalog enrichment
- PROXY_BASE_URL – optional upstream proxy for stream URLs
- CATALOG_PATH – location of catalog.json inside the container (defaults to /app/data/catalog.json)

To stop the container:

`ash
docker compose down
`

---

## Resolver + STRM Workflow (Manual)

1. **Install dependencies**
   `ash
   pip install -r requirements.txt
   playwright install firefox
   `

2. **Harvest URLs**
   `ash
   python scripts/collect_links.py --site hdfilm
   python scripts/collect_links.py --site dizibox --max-shows 100
   `
   Outputs are written to data/hdfilm_links.json and data/dizibox_links.json.

3. **Build Catalog**
   `ash
   python scripts/catalog_builder.py --tmdb-key ""
   `
   Generates data/catalog.json (falls back to minimal data if TMDB key is missing).

4. **Generate STRM Files**
   `ash
   python scripts/strm_generator.py --resolver-base http://127.0.0.1:5055
   `
   Creates STRM files under output/strm/. Point Jellyfin at this folder as a virtual library.

5. **Run Resolver API (non-docker)**
   `ash
   cd backend/resolver
   python api.py
   `
   Exposes:
   - POST /resolve – resolve an episode/movie URL
   - GET /stream/<token> – redirect/JSON with stream details
   - GET /catalog – returns the static catalog
   - GET /play/<id> – convenience route for catalog IDs

---

## Jellyfin Plugin

### Build & Package

`ash
dotnet build plugins/Streamarr/StreamarrPlugin.csproj -c Release
`
Artifacts appear in plugins/Streamarr/bin/Release/net8.0/ (StreamarrPlugin.dll, StreamarrPlugin.zip).

### Update Manifest

Use the helper script to refresh version, checksum, and download URL before publishing:

`ash
python scripts/update_manifest.py \
    --manifest docs/manifest.json \
    --zip plugins/Streamarr/bin/Release/net8.0/StreamarrPlugin.zip \
    --version 0.1.1 \
    --target-abi 10.9.0.0 \
    --source-url https://github.com/<user>/streamarr/releases/download/v0.1.1/StreamarrPlugin.zip \
    --guid 68c71f7d-a14e-4f21-9e10-7c02f51ae7b0 \
    --name Streamarr \
    --category General \
    --owner <user>
`

### Publish

1. Upload StreamarrPlugin.zip and the updated manifest.json (e.g., GitHub Release or Pages)
2. In Jellyfin: **Dashboard → Plugins → Repositories → Add** the manifest URL
3. Install "Streamarr" from the catalog
4. Configure the resolver base URL/API key in the plugin settings page

---

## Command Summary

`ash
python scripts/collect_links.py --site hdfilm
python scripts/collect_links.py --site dizibox --max-shows 50
python scripts/catalog_builder.py
python scripts/strm_generator.py
python backend/resolver/api.py
python scripts/update_manifest.py ...
dotnet build plugins/Streamarr/StreamarrPlugin.csproj -c Release
`

---

## Troubleshooting

- **Playwright errors** – Ensure playwright install firefox ran and system dependencies are present
- **TMDB enrichment skipped** – Set TMDB_KEY or pass --tmdb-key to catalog_builder.py
- **Checksum mismatch in Jellyfin** – Re-run scripts/update_manifest.py after re-packaging a ZIP
- **Plugin settings invisible** – Rebuild the plugin after updating configPage.html (assets are embedded)
- **Docker resolver not starting** – Run docker compose logs resolver for details

---

## Credits & Notes

- Scraper automation inspired by early Playwright POCs
- Thanks to community projects bridging Debrid services with Jellyfin
- Intended for personal/educational use only

Happy streaming!
