<div align="center">

# Streamarr

**Turkish Streaming Resolver Suite for Jellyfin**

</div>

Streamarr is an end-to-end toolkit that harvests stream URLs from popular Turkish streaming sites, exposes them through a resolver API, and delivers a Jellyfin plugin/STRM workflow so viewers can play content instantly without manual intervention.

## Highlights

- **Modular Architecture** – Playwright scrapers, resolver API, metadata enrichment, and plugin are cleanly separated
- **Dizibox & HDFilm Support** – Automations for the two most-requested Turkish streaming sites
- **On-Demand Resolution** – Short-lived stream URLs are resolved only when the user presses play
- **Jellyfin Plugin** – Adds a configuration UI and /play/<id> integration to Jellyfin
- **CLI Utilities** – Harvest URLs, build catalogs, generate STRM files, update plugin manifests
- **TMDB Metadata** – Optional enrichment for titles, posters, and overviews

## Repository Layout

| Path | Purpose |
|------|---------|
| ackend/resolver/ | Playwright scrapers & Flask resolver API |
| scripts/ | Command-line utilities (collect links, build catalog, STRM generation, manifest updates) |
| plugins/Streamarr/ | Jellyfin plugin source (config page, metadata providers, build output) |
| data/ | Harvested link lists and generated catalog (editable) |
| output/strm/ | Autogenerated STRM files ready to import into Jellyfin |
| docs/archive/ | Legacy POC notes, analyser docs, and exploratory scripts |

## Requirements

- **Python** 3.11+
- **Playwright** (pip install -r requirements.txt and playwright install firefox)
- **.NET SDK** 8.0 (for Jellyfin plugin builds)
- **Optional** TMDB API key (export TMDB_KEY=...) for catalog enrichment

## Quick Start (Resolver + STRM)

### 1. Install dependencies

`ash
pip install -r requirements.txt
playwright install firefox
`

### 2. Harvest URLs

`ash
python scripts/collect_links.py --site hdfilm
python scripts/collect_links.py --site dizibox --max-shows 100
`
Outputs are saved to data/hdfilm_links.json and data/dizibox_links.json.

### 3. Build Catalog

`ash
python scripts/catalog_builder.py --tmdb-key 
`
Generates data/catalog.json with metadata (falls back to minimal data if TMDB key is unavailable).

### 4. Generate STRM Files

`ash
python scripts/strm_generator.py --resolver-base http://127.0.0.1:5055
`
Creates STRM files under output/strm/. Add this directory to Jellyfin as a virtual library.

### 5. Run Resolver API

`ash
cd backend/resolver
python api.py
`
Endpoints:
- POST /resolve – Resolve an episode/movie URL
- GET /stream/<token> – Redirect or JSON with stream details
- GET /catalog – Returns the static catalog (used by STRM/Plugin)
- GET /play/<id> – Convenience route for catalog IDs (redirects to /stream/<token>)

## Jellyfin Plugin

### Build & Package

`ash
dotnet build plugins/Streamarr/StreamarrPlugin.csproj -c Release
`
Artifacts appear under plugins/Streamarr/bin/Release/net8.0/:
- StreamarrPlugin.dll
- StreamarrPlugin.zip (DLL + metadata)

### Update Manifest

Use the helper script to update version, checksum, and download URL:

`ash
python scripts/update_manifest.py \
    --manifest docs/manifest.json \
    --zip plugins/Streamarr/bin/Release/net8.0/StreamarrPlugin.zip \
    --version 0.1.1 \
    --target-abi 10.9.0.0 \
    --source-url https://github.com/<user>/streamarr/releases/download/v0.1.1/StreamarrPlugin.zip \
    --guid 68c71f7d-a14e-4f21-9e10-7c02f51ae7b0 \
    --name Streamarr \
    --category General \
    --owner <user>
`

### Publish

1. Upload StreamarrPlugin.zip and updated manifest.json to your GitHub release or GitHub Pages
2. In Jellyfin admin UI → **Plugins → Repositories → Add** the manifest URL
3. Locate “Streamarr” under the catalog and install
4. Configure resolver URL/API key in Jellyfin’s plugin settings page

## Automation Workflow

1. User selects content from the STRM library or via the Jellyfin plugin configuration
2. GET /play/<id> (or /resolve) triggers Playwright automation to capture the live stream
3. Resolver returns a short-lived token; Jellyfin redirects to /stream/<token>
4. Playback starts in Jellyfin using the resolved stream URL

## Command Summary

`ash
python scripts/collect_links.py --site hdfilm
python scripts/collect_links.py --site dizibox --max-shows 50
python scripts/catalog_builder.py
python scripts/strm_generator.py
python backend/resolver/api.py
python scripts/update_manifest.py ...
dotnet build plugins/Streamarr/StreamarrPlugin.csproj -c Release
`

## Troubleshooting

- **Playwright errors** – Ensure playwright install firefox was run and system dependencies for Firefox are present
- **TMDB enrichment skipped** – Set TMDB_KEY or pass --tmdb-key to catalog_builder.py
- **Checksum mismatch in Jellyfin** – Re-run scripts/update_manifest.py after packaging a new ZIP
- **Plugin settings not visible** – Build the plugin after updating configPage.html (UI assets are embedded resources)

## Credits & Notes

- Dizibox/HDFilm automation built atop Playwright POC scripts
- Inspired by jf-resolve and other Debrid-to-Jellyfin bridging projects
- Intended for personal/educational use only

Happy streaming!
